<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Carte Admin + Firebase</title>
<style>
body {margin:0; background:#0b0b12; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; font-family:sans-serif; color:#fff;}
.map-container {position:relative; display:inline-block; max-width:100%; max-height:100vh; overflow:auto;}
.map-container img.Map {display:block; width:100%; height:auto;}
.point {position:absolute; width:32px; height:32px; transform:translate(-50%, -50%); cursor:pointer;}
#admin-btn {position:fixed; top:10px; right:10px; background:#222; color:#fff; border:1px solid #555; border-radius:6px; padding:6px 10px; cursor:pointer;}
#edit-hint {position:fixed; top:50px; right:10px; background:rgba(0,0,0,0.6); padding:5px 8px; border-radius:4px; font-size:13px; display:none;}
</style>
</head>
<body>

<div class="map-container" id="map-container">
  <img src="Map.png" alt="Map" class="Map" id="Map">
</div>

<button id="admin-btn">ðŸ‘‘ Admin</button>
<div id="edit-hint">Mode Ã©dition actif â€” Clique sur la map pour ajouter un point</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
const ADMIN_ID = "admin";
const ADMIN_PWD = "1234";
const POINT_IMG = "point.gif";

let editMode = false;
const adminBtn = document.getElementById("admin-btn");
const editHint = document.getElementById("edit-hint");
const mapContainer = document.getElementById("map-container");
const MapImage = document.getElementById("Map");

// --- Firebase config ---
const firebaseConfig = {
  apiKey: "TON_API_KEY",
  authDomain: "TON_PROJET.firebaseapp.com",
  databaseURL: "https://TON_PROJET.firebaseio.com",
  projectId: "TON_PROJET",
  storageBucket: "TON_PROJET.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- CrÃ©e un point ---
function createPoint(xPercent, yPercent, url) {
  const a = document.createElement("a");
  a.href = url;
  a.target = "_blank";
  a.className = "point";
  a.dataset.x = xPercent;
  a.dataset.y = yPercent;

  const img = document.createElement("img");
  img.src = POINT_IMG;
  img.width = 32;
  img.height = 32;
  img.alt = "Point lumineux";

  a.appendChild(img);
  mapContainer.appendChild(a);
  updatePoints();
}

// --- Repositionne points ---
function updatePoints() {
  const rect = MapImage.getBoundingClientRect();
  document.querySelectorAll(".point").forEach(a => {
    const x = parseFloat(a.dataset.x);
    const y = parseFloat(a.dataset.y);
    a.style.left = (x * rect.width / 100) + "px";
    a.style.top = (y * rect.height / 100) + "px";
  });
}
window.addEventListener("resize", updatePoints);

// --- Charger points depuis Firebase ---
function loadPoints() {
  db.ref('points').on('value', snapshot => {
    mapContainer.querySelectorAll('.point').forEach(p => p.remove());
    const points = snapshot.val();
    if(points){
      Object.values(points).forEach(p => createPoint(p.x, p.y, p.url));
    }
  });
}

// --- Ajouter point Firebase ---
function savePointFirebase(xPercent, yPercent, url){
  const newRef = db.ref('points').push();
  newRef.set({x: xPercent, y: yPercent, url: url});
}

// --- Admin login ---
adminBtn.addEventListener("click", () => {
  if(!editMode){
    const id = prompt("Identifiant admin :");
    const pwd = prompt("Mot de passe :");
    if(id===ADMIN_ID && pwd===ADMIN_PWD){
      editMode = true;
      editHint.style.display = "block";
      adminBtn.textContent = "ðŸšª Quitter Ã©dition";
    } else alert("Mauvais identifiant ou mot de passe.");
  } else {
    editMode=false;
    editHint.style.display="none";
    adminBtn.textContent="ðŸ‘‘ Admin";
  }
});

// --- Ajouter point au clic ---
mapContainer.addEventListener("click", e => {
  if(!editMode) return;
  const rect = MapImage.getBoundingClientRect();
  const xPercent = ((e.clientX - rect.left)/rect.width)*100;
  const yPercent = ((e.clientY - rect.top)/rect.height)*100;
  const url = prompt("Entre lâ€™URL du point :");
  if(!url) return;
  createPoint(xPercent,yPercent,url);
  savePointFirebase(xPercent,yPercent,url);
});

// --- Init ---
loadPoints();
</script>

</body>
</html>
