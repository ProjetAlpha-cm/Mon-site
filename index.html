<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Carte ARG finale</title>
<style>
body {margin:0; background:#0b0b12; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; font-family:sans-serif; color:#fff;}
.map-container {position:relative; display:inline-block; max-width:100%; max-height:100vh; overflow:auto;}
.map-container img.Map {display:block; width:100%; height:auto;}

/* POINTS */
.point {
  position:absolute;
  width:100px;
  height:100px;
  transform:translate(-50%, -50%);
  cursor:pointer;
  animation: pulse 1.5s infinite;
  filter: drop-shadow(0 0 15px #00ffcc);
}
.point img { display:block; width:100%; height:100%; }
@keyframes pulse {
  0% { transform: translate(-50%, -50%) scale(1); opacity:1; }
  50% { transform: translate(-50%, -50%) scale(1.1); opacity:0.8; }
  100% { transform: translate(-50%, -50%) scale(1); opacity:1; }
}
@keyframes glitch {
  0% { clip: rect(0, 100px, 100px, 0); transform: translate(0);}
  20% { clip: rect(10px, 100px, 80px, 0); transform: translate(-2px, -2px);}
  40% { clip: rect(20px, 100px, 90px, 0); transform: translate(2px, 2px);}
  60% { clip: rect(0, 100px, 100px, 0); transform: translate(-1px,1px);}
  80% { clip: rect(15px, 100px, 85px, 0); transform: translate(1px,-1px);}
  100% { clip: rect(0, 100px, 100px, 0); transform: translate(0);}
}
.point:hover {
  animation: pulse 1.5s infinite, glitch 0.3s infinite;
  filter: drop-shadow(0 0 20px #ff00ff) drop-shadow(0 0 10px #00ffff);
}

/* POPUP */
.popup-glitch { animation: glitch 0.2s infinite alternate; }

#admin-btn {position:fixed; top:10px; right:10px; background:#222; color:#fff; border:1px solid #555; border-radius:6px; padding:6px 10px; cursor:pointer;}
#edit-hint {position:fixed; top:50px; right:10px; background:rgba(0,0,0,0.6); padding:5px 8px; border-radius:4px; font-size:13px; display:none;}
</style>
</head>
<body>

<div class="map-container" id="map-container">
  <img src="Map.png" alt="Map" class="Map" id="Map">
</div>

<button id="admin-btn">ðŸ‘‘ Admin</button>
<div id="edit-hint">Mode Ã©dition actif â€” Clique sur la map pour ajouter un point</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
const ADMIN_ID="admin";
const ADMIN_PWD="1234";
const POINT_IMG="point.gif"; // GIF agrandi
let editMode=false;
const adminBtn=document.getElementById("admin-btn");
const editHint=document.getElementById("edit-hint");
const mapContainer=document.getElementById("map-container");
const MapImage=document.getElementById("Map");

// --- Sons alÃ©atoires ---
const sounds=["sound1.mp3","sound2.mp3","sound3.mp3"];
function playRandomSound(){const s=new Audio(sounds[Math.floor(Math.random()*sounds.length)]);s.volume=0.5;s.play();}

// --- Firebase config ---
const firebaseConfig = {
  apiKey: "AIzaSyCpaNYX7fFEyvYWHlSsRoYhU6IsjKDAf6c",
  authDomain: "mappointsproject.firebaseapp.com",
  databaseURL: "https://mappointsproject-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "mappointsproject",
  storageBucket: "mappointsproject.firebasestorage.com",
  messagingSenderId: "38040390635",
  appId: "1:38040390635:web:069d2fd886af8cbefba7ae"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

// --- CrÃ©e un point ---
function createPoint(x,y,type,content,enigme,code){
  const point=document.createElement("div");
  point.className="point";
  point.dataset.x=x;
  point.dataset.y=y;
  point.dataset.type=type;
  point.dataset.content=content;
  point.dataset.enigme=enigme;
  point.dataset.code=code||"";

  const img=document.createElement("img");
  img.src=POINT_IMG;
  img.alt="Point lumineux";
  point.appendChild(img);
  mapContainer.appendChild(point);
  updatePoints();

  point.addEventListener("click",ev=>{
    ev.stopPropagation();
    playRandomSound();
    const popup=document.createElement("div");
    popup.style.position="fixed";
    popup.style.top=0; popup.style.left=0; popup.style.width="100%"; popup.style.height="100%";
    popup.style.background="rgba(0,0,0,0.9)"; popup.style.display="flex"; popup.style.flexDirection="column";
    popup.style.justifyContent="center"; popup.style.alignItems="center"; popup.style.zIndex=9999;
    popup.style.padding="20px"; popup.style.textAlign="center";
    popup.classList.add("popup-glitch");

    const enig=document.createElement("div");
    enig.textContent=enigme||"Mini-Ã©nigme...";
    enig.style.color="#00ffcc"; enig.style.fontSize="20px"; enig.style.marginBottom="20px";
    popup.appendChild(enig);

    if(code){
      const input=document.createElement("input");
      input.placeholder="Entrez le code"; input.style.padding="8px"; input.style.fontSize="16px"; input.style.marginBottom="10px";
      const btn=document.createElement("button");
      btn.textContent="Valider"; btn.style.padding="8px 12px"; btn.style.cursor="pointer";
      btn.addEventListener("click",()=>{if(input.value===code) showContent(type,content,popup); else alert("Code incorrect !");});
      popup.appendChild(input); popup.appendChild(btn);
    }else showContent(type,content,popup);

    document.body.appendChild(popup);
    popup.addEventListener("click",e=>{if(e.target===popup) popup.remove();});
  });
}

// --- Affiche contenu selon type ---
function showContent(type,content,popup){
  if(type==="image"){
    const img=document.createElement("img");
    img.src=content; img.style.maxWidth="80%"; img.style.maxHeight="50%";
    img.style.border="4px solid #00ffcc"; img.style.borderRadius="8px"; img.style.marginTop="10px";
    popup.appendChild(img);
  }else if(type==="lien"){
    const a=document.createElement("a"); a.href=content; a.target="_blank"; a.textContent=content;
    a.style.color="#00ffcc"; a.style.fontSize="18px"; a.style.marginTop="10px";
    popup.appendChild(a);
  }else if(type==="texte"){
    const div=document.createElement("div"); div.textContent=content;
    div.style.color="#00ffcc"; div.style.fontSize="18px"; div.style.marginTop="10px";
    popup.appendChild(div);
  }
}

// --- Repositionne points ---
function updatePoints(){
  const rect=MapImage.getBoundingClientRect();
  document.querySelectorAll(".point").forEach(p=>{
    const x=parseFloat(p.dataset.x); const y=parseFloat(p.dataset.y);
    p.style.left=(x*rect.width/100)+"px"; p.style.top=(y*rect.height/100)+"px";
  });
}

// --- Charger points depuis Firebase ---
function loadPoints(){
  db.ref('points').on('value',snapshot=>{
    mapContainer.querySelectorAll('.point').forEach(p=>p.remove());
    const pts=snapshot.val();
    if(pts) Object.values(pts).forEach(p=>createPoint(p.x,p.y,p.type,p.content,p.enigme,p.code));
  });
}

// --- Ajouter point Firebase ---
function savePointFirebase(x,y,type,content,enigme,code){
  const newRef=db.ref('points').push();
  newRef.set({x:x,y:y,type:type,content:content,enigme:enigme,code:code});
}

// --- Admin login ---
adminBtn.addEventListener("click",()=>{
  if(!editMode){
    const id=prompt("Identifiant admin :"); const pwd=prompt("Mot de passe :");
    if(id===ADMIN_ID && pwd===ADMIN_PWD){editMode=true; editHint.style.display="block"; adminBtn.textContent="ðŸšª Quitter Ã©dition";}
    else alert("Mauvais identifiant ou mot de passe.");
  }else{editMode=false; editHint.style.display="none"; adminBtn.textContent="ðŸ‘‘ Admin";}
});

// --- Ajouter point au clic ---
mapContainer.addEventListener("click",e=>{
  if(!editMode) return;
  const rect=MapImage.getBoundingClientRect();
  const xPercent=((e.clientX-rect.left)/rect.width)*100;
  const yPercent=((e.clientY-rect.top)/rect.height)*100;

  const type=prompt("Type de contenu : image / lien / texte").toLowerCase();
  if(!["image","lien","texte"].includes(type)) return;
  const content=prompt("Entrez le contenu (URL ou texte)");
  const enigme=prompt("Entrez le texte de lâ€™Ã©nigme Ã  afficher :");
  const useCode=confirm("Voulez-vous un code secret ?");
  const code=useCode?prompt("Entrez le code secret :"):"";

  createPoint(xPercent,yPercent,type,content,enigme,code);
  savePointFirebase(xPercent,yPercent,type,content,enigme,code);
});

// --- Initialisation aprÃ¨s chargement image ---
MapImage.addEventListener("load",()=>{updatePoints(); loadPoints();});
if(MapImage.complete) {updatePoints(); loadPoints();}
</script>

</body>
</html>


