<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Carte ARG</title>
<style>
body {margin:0; background:#0b0b12; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; font-family:sans-serif; color:#fff;}
.map-container {position:relative; display:inline-block; max-width:100%; max-height:100vh; overflow:auto;}
.map-container img.Map {display:block; width:100%; height:auto;}
.point {
  position:absolute;
  width:100px;
  height:100px;
  transform:translate(-50%, -50%);
  cursor:pointer;
  animation: pulse 1.5s infinite;
  filter: drop-shadow(0 0 15px #00ffcc);
}
@keyframes pulse {
  0% { transform: translate(-50%, -50%) scale(1); opacity:1; }
  50% { transform: translate(-50%, -50%) scale(1.1); opacity:0.8; }
  100% { transform: translate(-50%, -50%) scale(1); opacity:1; }
}
#admin-btn {position:fixed; top:10px; right:10px; background:#222; color:#fff; border:1px solid #555; border-radius:6px; padding:6px 10px; cursor:pointer;}
#edit-hint {position:fixed; top:50px; right:10px; background:rgba(0,0,0,0.6); padding:5px 8px; border-radius:4px; font-size:13px; display:none;}
</style>
</head>
<body>

<div class="map-container" id="map-container">
  <img src="Map.png" alt="Map" class="Map" id="Map">
</div>

<button id="admin-btn">ðŸ‘‘ Admin</button>
<div id="edit-hint">Mode Ã©dition actif â€” Clique sur la map pour ajouter un point</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
const ADMIN_ID = "admin";
const ADMIN_PWD = "1234";
const POINT_IMG = "point.gif"; // GIF agrandi via CSS

let editMode = false;
const adminBtn = document.getElementById("admin-btn");
const editHint = document.getElementById("edit-hint");
const mapContainer = document.getElementById("map-container");
const MapImage = document.getElementById("Map");

// --- Firebase config ---
const firebaseConfig = {
  apiKey: "AIzaSyCPMSVPXjvfnu7ZPjVQPpl2DWmWqUxqtmU",
  authDomain: "pointpa-9340d.firebaseapp.com",
  databaseURL: "https://pointpa-9340d-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "pointpa-9340d",
  storageBucket: "pointpa-9340d.firebasestorage.app",
  messagingSenderId: "6068299778",
  appId: "1:6068299778:web:3c35e60025d7bdbc131f1b"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- CrÃ©e un point ---
function createPoint(xPercent, yPercent, url) {
  const point = document.createElement("div");
  point.className = "point";
  point.dataset.x = xPercent;
  point.dataset.y = yPercent;
  point.dataset.img = url;

  const img = document.createElement("img");
  img.src = POINT_IMG;
  img.alt = "Point lumineux";
  img.style.width = "100%";
  img.style.height = "100%";

  point.appendChild(img);
  mapContainer.appendChild(point);
  updatePoints();

  // --- Mini-Ã©nigme popup ---
  point.addEventListener("click", (ev) => {
    ev.stopPropagation();
    const imageUrl = point.dataset.img;
    const popup = document.createElement("div");
    popup.style.position = "fixed";
    popup.style.top = 0;
    popup.style.left = 0;
    popup.style.width = "100%";
    popup.style.height = "100%";
    popup.style.background = "rgba(0,0,0,0.9)";
    popup.style.display = "flex";
    popup.style.flexDirection = "column";
    popup.style.justifyContent = "center";
    popup.style.alignItems = "center";
    popup.style.zIndex = 9999;

    const imgPopup = document.createElement("img");
    imgPopup.src = imageUrl;
    imgPopup.style.maxWidth = "80%";
    imgPopup.style.maxHeight = "50%";
    imgPopup.style.border = "4px solid #00ffcc";
    imgPopup.style.borderRadius = "8px";
    imgPopup.style.marginBottom = "20px";

    const enigme = document.createElement("div");
    enigme.textContent = "Mini-Ã©nigme : Quel est le code secret visible sur l'image ?";
    enigme.style.color = "#00ffcc";
    enigme.style.fontSize = "20px";
    enigme.style.textAlign = "center";

    popup.appendChild(imgPopup);
    popup.appendChild(enigme);
    document.body.appendChild(popup);

    popup.addEventListener("click", () => {
      popup.remove();
    });
  });
}

// --- Repositionne points ---
function updatePoints() {
  const rect = MapImage.getBoundingClientRect();
  document.querySelectorAll(".point").forEach(p => {
    const x = parseFloat(p.dataset.x);
    const y = parseFloat(p.dataset.y);
    p.style.left = (x * rect.width / 100) + "px";
    p.style.top = (y * rect.height / 100) + "px";
  });
}
window.addEventListener("resize", updatePoints);

// --- Charger points depuis Firebase ---
function loadPoints() {
  db.ref('points').on('value', snapshot => {
    mapContainer.querySelectorAll('.point').forEach(p => p.remove());
    const points = snapshot.val();
    if(points){
      Object.values(points).forEach(p => createPoint(p.x, p.y, p.url));
    }
  });
}

// --- Ajouter point Firebase ---
function savePointFirebase(xPercent, yPercent, url){
  const newRef = db.ref('points').push();
  newRef.set({x: xPercent, y: yPercent, url: url});
}

// --- Admin login ---
adminBtn.addEventListener("click", () => {
  if(!editMode){
    const id = prompt("Identifiant admin :");
    const pwd = prompt("Mot de passe :");
    if(id===ADMIN_ID && pwd===ADMIN_PWD){
      editMode = true;
      editHint.style.display = "block";
      adminBtn.textContent = "ðŸšª Quitter Ã©dition";
    } else alert("Mauvais identifiant ou mot de passe.");
  } else {
    editMode=false;
    editHint.style.display="none";
    adminBtn.textContent="ðŸ‘‘ Admin";
  }
});

// --- Ajouter point au clic ---
mapContainer.addEventListener("click", e => {
  if(!editMode) return;
  const rect = MapImage.getBoundingClientRect();
  const xPercent = ((e.clientX - rect.left)/rect.width)*100;
  const yPercent = ((e.clientY - rect.top)/rect.height)*100;
  const url = prompt("Entre lâ€™URL de lâ€™image Ã  afficher au clic :");
  if(!url) return;
  createPoint(xPercent,yPercent,url);
  savePointFirebase(xPercent,yPercent,url);
});

// --- Init ---
loadPoints();
</script>

</body>
</html>






